<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>快帮邦后台管理系统</title>
<link rel="icon" href="images/logo-ico.png" type="image/ico">


<meta name="author" content="yinqi">
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/materialdesignicons.min.css" rel="stylesheet">
<!--对话框插件样式-->
<link rel="stylesheet" href="js/jconfirm/jquery-confirm.min.css">
<link href="css/style.css" rel="stylesheet">
</head>

<body data-logobg="color_8" data-sidebarbg="color_8">
	<div class="lyear-layout-web">
		<div class="lyear-layout-container">
			<!--左侧导航-->
			<aside class="lyear-layout-sidebar">

				<!-- logo -->
				<div id="logo" class="sidebar-header">
					<a href="index.html"><img src="images/logo-sidebar.png" title="LightYear" alt="LightYear" /></a>
				</div>
				<div class="lyear-layout-sidebar-scroll"> 
        
        <nav class="sidebar-main">
          <ul class="nav nav-drawer">
			<li class="nav-item"><a href="index.html"><i
			class="mdi mdi-home"></i> 后台首页</a></li>
			
			<li class="nav-item nav-item-has-subnav">
				<a href="javascript:void(0)"><i class="mdi mdi-account"></i> 用户管理</a>
				<ul class="nav nav-subnav">
					<li class="active"><a href="userManager.html">普通用户</a></li>
					<li><a href="shopManager.html">服务商</a></li>
				</ul>
			</li>
			<li class="nav-item"><a href="order.html"><i class="mdi mdi-paper-cut-vertical"></i> 任务订单管理</a></li>
			<li class="nav-item nav-item-has-subnav">
				<a href="javascript:void(0)"><i class="mdi mdi-settings"></i> 系统管理</a>
				<ul class="nav nav-subnav">
					<li class="active"><a href="403.html">403页面</a></li>
					<li><a href="404.html">404页面</a></li>
					<li><a href="500.html">500页面</a></li>
				</ul>
			</li>
							
		 </ul>
        </nav>
        
        
      </div>
	</aside>
			<!--End 左侧导航-->

			<!--头部信息-->
			<header class="lyear-layout-header">

				<nav class="navbar navbar-default">
					<div class="topbar">

						<div class="topbar-left">
							<div class="lyear-aside-toggler">
								<span class="lyear-toggler-bar"></span> <span
									class="lyear-toggler-bar"></span> <span
									class="lyear-toggler-bar"></span>
							</div>
							<span class="navbar-page-title"> 示例页面 - 文档列表 </span>
						</div>

						<ul class="topbar-right">
							<li class="dropdown dropdown-profile"><a
								href="javascript:void(0)" data-toggle="dropdown"> <img
									class="img-avatar img-avatar-48 m-r-10"
									src="images/users/avatar.jpg" alt="管理员" /> <span>管理员 <span
										class="caret"></span></span>
							</a>
								<ul class="dropdown-menu dropdown-menu-right">
									<li><a href="personalInfo.html"><i
											class="mdi mdi-account"></i> 个人信息</a></li>
									<li><a href="edit_pwd.html"><i
											class="mdi mdi-lock-outline"></i> 修改密码</a></li>
									<li><a href="javascript:void(0)"><i
											class="mdi mdi-delete"></i> 清空缓存</a></li>
									<li class="divider"></li>
									<li><a href="pages_login.html"><i
											class="mdi mdi-logout-variant"></i> 退出登录</a></li>
								</ul></li>
							<!--切换主题配色-->
							<li class="dropdown dropdown-skin"><span
								data-toggle="dropdown" class="icon-palette"><i
									class="mdi mdi-palette"></i></span>
								<ul class="dropdown-menu dropdown-menu-right"
									data-stopPropagation="true">
									<li class="drop-title"><p>主题</p></li>
									<li class="drop-skin-li clearfix"><span class="inverse">
											<input type="radio" name="site_theme" value="default"
											id="site_theme_1" checked> <label for="site_theme_1"></label>
									</span> <span> <input type="radio" name="site_theme"
											value="dark" id="site_theme_2"> <label
											for="site_theme_2"></label>
									</span> <span> <input type="radio" name="site_theme"
											value="translucent" id="site_theme_3"> <label
											for="site_theme_3"></label>
									</span></li>
									<li class="drop-title"><p>LOGO</p></li>
									<li class="drop-skin-li clearfix"><span class="inverse">
											<input type="radio" name="logo_bg" value="default"
											id="logo_bg_1" checked> <label for="logo_bg_1"></label>
									</span> <span> <input type="radio" name="logo_bg"
											value="color_2" id="logo_bg_2"> <label
											for="logo_bg_2"></label>
									</span> <span> <input type="radio" name="logo_bg"
											value="color_3" id="logo_bg_3"> <label
											for="logo_bg_3"></label>
									</span> <span> <input type="radio" name="logo_bg"
											value="color_4" id="logo_bg_4"> <label
											for="logo_bg_4"></label>
									</span> <span> <input type="radio" name="logo_bg"
											value="color_5" id="logo_bg_5"> <label
											for="logo_bg_5"></label>
									</span> <span> <input type="radio" name="logo_bg"
											value="color_6" id="logo_bg_6"> <label
											for="logo_bg_6"></label>
									</span> <span> <input type="radio" name="logo_bg"
											value="color_7" id="logo_bg_7"> <label
											for="logo_bg_7"></label>
									</span> <span> <input type="radio" name="logo_bg"
											value="color_8" id="logo_bg_8"> <label
											for="logo_bg_8"></label>
									</span></li>
									<li class="drop-title"><p>头部</p></li>
									<li class="drop-skin-li clearfix"><span class="inverse">
											<input type="radio" name="header_bg" value="default"
											id="header_bg_1" checked> <label for="header_bg_1"></label>
									</span> <span> <input type="radio" name="header_bg"
											value="color_2" id="header_bg_2"> <label
											for="header_bg_2"></label>
									</span> <span> <input type="radio" name="header_bg"
											value="color_3" id="header_bg_3"> <label
											for="header_bg_3"></label>
									</span> <span> <input type="radio" name="header_bg"
											value="color_4" id="header_bg_4"> <label
											for="header_bg_4"></label>
									</span> <span> <input type="radio" name="header_bg"
											value="color_5" id="header_bg_5"> <label
											for="header_bg_5"></label>
									</span> <span> <input type="radio" name="header_bg"
											value="color_6" id="header_bg_6"> <label
											for="header_bg_6"></label>
									</span> <span> <input type="radio" name="header_bg"
											value="color_7" id="header_bg_7"> <label
											for="header_bg_7"></label>
									</span> <span> <input type="radio" name="header_bg"
											value="color_8" id="header_bg_8"> <label
											for="header_bg_8"></label>
									</span></li>
									<li class="drop-title"><p>侧边栏</p></li>
									<li class="drop-skin-li clearfix"><span class="inverse">
											<input type="radio" name="sidebar_bg" value="default"
											id="sidebar_bg_1" checked> <label for="sidebar_bg_1"></label>
									</span> <span> <input type="radio" name="sidebar_bg"
											value="color_2" id="sidebar_bg_2"> <label
											for="sidebar_bg_2"></label>
									</span> <span> <input type="radio" name="sidebar_bg"
											value="color_3" id="sidebar_bg_3"> <label
											for="sidebar_bg_3"></label>
									</span> <span> <input type="radio" name="sidebar_bg"
											value="color_4" id="sidebar_bg_4"> <label
											for="sidebar_bg_4"></label>
									</span> <span> <input type="radio" name="sidebar_bg"
											value="color_5" id="sidebar_bg_5"> <label
											for="sidebar_bg_5"></label>
									</span> <span> <input type="radio" name="sidebar_bg"
											value="color_6" id="sidebar_bg_6"> <label
											for="sidebar_bg_6"></label>
									</span> <span> <input type="radio" name="sidebar_bg"
											value="color_7" id="sidebar_bg_7"> <label
											for="sidebar_bg_7"></label>
									</span> <span> <input type="radio" name="sidebar_bg"
											value="color_8" id="sidebar_bg_8"> <label
											for="sidebar_bg_8"></label>
									</span></li>
								</ul></li>
							<!--切换主题配色-->
						</ul>

					</div>
				</nav>

			</header>
			<!--End 头部信息-->

			<!--页面主要内容-->
			<main class="lyear-layout-content">

			<div class="container-fluid" id="vue-model">

				<div class="row">
					<div class="col-lg-12">
						<div class="card">
							<div class="card-toolbar clearfix">
								<!-- onsubmit="return false;"：去除回车自动提交表单 -->
								<form class="pull-right search-bar"	role="form" onsubmit="return false;">
									<div class="input-group">
										<div class="input-group-btn">
											<input type="hidden" name="search_field" id="search-field"
												value="title" v-model="searchType">
											<button class="btn btn-default dropdown-toggle"
												id="search-btn" data-toggle="dropdown" type="button"
												aria-haspopup="true" aria-expanded="false">
												标题 <span class="caret"></span>
											</button>
											<ul class="dropdown-menu">
												<li><a tabindex="-1" href="javascript:void(0)"
													data-field="title">标题</a></li>
												<li><a tabindex="-1" href="javascript:void(0)"
													data-field="id">任务订单id</a></li>
											</ul>
										</div>
										<!-- @keyup.enter="search":绑定回车监听事件 -->
										<input type="text" class="form-control" value=""
											placeholder="请输入名称" v-model="searchKey" @keyup.enter="search">
									</div>
								</form>
								<div class="toolbar-btn-action">
									<a class="btn btn-primary m-r-5" @click="add"><i
										class="mdi mdi-plus"></i> 新增</a> 
								</div>
							</div>
							<div class="card-body">

								<div class="table-responsive">
									<table class="table table-bordered">
										<thead>
											<tr>
												<th><label class="lyear-checkbox checkbox-primary">
														<input type="checkbox" id="check-all"><span></span>
												</label></th>
												<th>编号</th>
												<th>雇主</th>
												<th>联系电话</th>
												<th>下单时间</th>
												<th>服务地址</th>
												<th>问题描述</th>
												<th>图片1</th>
												<th>图片2</th>
												<th>图片3</th>
												<th>佣金</th>
												<th>订单状态</th>
												<th>操作</th>
											</tr>
										</thead>
										<tbody>
											<tr v-for="(item,index) in list">
												<td><label class="lyear-checkbox checkbox-primary">
														<input type="checkbox" name="ids[]" value="1"><span></span>
												</label></td>
												<td>{{index+1}}</td>
												<td>{{item.user}}</td>
												<td>{{item.phone}}</td>
												<td>{{item.time}}</td>
												<td>{{item.address}}</td>
												<td>{{item.describe}}</td>
												<td class="col-xs-4 col-sm-3 col-md-2"><img
													v-bind:src="item.img_1+'?a='+new Date().valueOf()" /></td>
												<td class="col-xs-4 col-sm-3 col-md-2"><img
													v-bind:src="item.img_2+'?a='+new Date().valueOf()" /></td>
												<td class="col-xs-4 col-sm-3 col-md-2"><img
													v-bind:src="item.img_3+'?a='+new Date().valueOf()" /></td>
												<td>{{item.money}}</td>
												<td><font class="text-success">{{item.state}}</font></td>
												<td>
													<div class="btn-group">
														<a class="btn btn-xs btn-default" href="#!" title="编辑"
															data-toggle="tooltip" @click="edit(item.id)"><i
															class="mdi mdi-pencil"></i></a> <a
															class="btn btn-xs btn-default" href="#!" title="删除"
															data-toggle="tooltip" @click="del(item)"><i
															class="mdi mdi-window-close"></i></a>
													</div>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
								<ul class="pagination">
									<li class="disabled"><span>«</span></li>
									<li class="active"><span>1</span></li>
									<li><a href="#2">2</a></li>
									<li><a href="#1">3</a></li>
									<li><a href="#1">4</a></li>
									<li><a href="#1">5</a></li>
									<li><a href="#1">6</a></li>
									<li><a href="#1">7</a></li>
									<li><a href="#1">8</a></li>
									<li class="disabled"><span>...</span></li>
									<li><a href="#!">14452</a></li>
									<li><a href="#!">14453</a></li>
									<li><a href="#!">»</a></li>
								</ul>

							</div>
						</div>
					</div>

				</div>

			</div>

			</main>
			<!--End 页面主要内容-->
		</div>
	</div>

	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/perfect-scrollbar.min.js"></script>
	<script type="text/javascript" src="js/main.js"></script>
	<!-- 引入vue的JS文件 -->
	<script type="text/javascript" src="js/vue.js"></script>
	<!--对话框插件-->
	<script src="js/jconfirm/jquery-confirm.min.js"></script>
	<!-- 网络请求 -->
	<script type="text/javascript" src="js/axios.js"></script>
	<!-- 参数处理JS，与axios配合使用 -->
	<script type="text/javascript" src="js/qs.js"></script>
	<!-- 进度加载显示 -->
	<script type="text/javascript" src="js/lightyear.js"></script>
	<script type="text/javascript">
	// 页面内容加载完成前调用
	$(function() {
		$('.search-bar .dropdown-menu a')
				.click(
						function() {
							var field = $(this).data('field') || '';
							$('#search-field').val(field);
							myVue.searchType = field;	// 通过val()方法赋值input标签，myVue绑定的属性无效，只能单独赋值
							$('#search-btn')
									.html(
											$(this).text()
													+ ' <span class="caret"></span>');
						});
		
	})
	
	// 页面内容加载完成后调用
	window.onload = function(){
		getData();
	}
	
	function getData() {
		lightyear.loading('show');
		var params = {},
			data = '';
		if(myVue.searchKey != ''){
			if(myVue.searchType == 'title'){
				params = {
						method: 'post',
						url: '/kbb/searchTask',
						headers:{'content-type': 'application/x-www-form-urlencoded'},
						data: Qs.stringify({word: myVue.searchKey})		
					}
			}else if(myVue.searchType == 'id'){
				params = {
						method: 'post',
						url: '/kbb/orderDetail',
						headers:{'content-type': 'application/x-www-form-urlencoded'},
						data: Qs.stringify({id: myVue.searchKey})		
					}
			}
		}else{
			params = {
					method: 'get',
					url: '/kbb/order',	
				}
		}
		// 网络请求接口，axios为Vue官方推荐异步请求方式
		axios(params).then((response)=>{
			console.log(response);
                myVue.list = response.data;	// 请求成功，挂载数据到Vue的data中
				lightyear.loading('hide');
            }).catch((error)=>{
            	lightyear.loading('hide');
                console.log(error);
            })
	}
	
	// Vue封装
	var myVue = new Vue({
		el : '#vue-model',		// 作用域，绑定页面中标签的id，则此标签为myVue的作用域
		data : {				// 在作用域中可绑定的数据
			list: [],
			searchType: 'title',
			searchKey: ''
		},
		methods : {				// 在作用域中可绑定的方法
			search(){
				console.log("search")
				getData();
			},
			add(){				// 新增
				window.location.href = "/kbb/admin/addOrder.html?type=add";
			},
			
			edit(id){			// 编辑
				window.location.href = "/kbb/admin/addOrder.html?type=edit&id=" + id;
			},
			
			del(item){			// 删除
				$.confirm({
			        title: '提示',
			        content: '确定删除此项？',
			        type: 'red',
			        typeAnimated: true,
			        buttons: {
			        	confirm: {
			                text: '删除',
			                btnClass: 'btn-red',
			                action: function(){
			                	lightyear.loading('show');
			            		// 网络请求接口，axios为Vue官方推荐异步请求方式
			            		axios({
			            			method: 'post',
			            			url: '/kbb/deleteOrder',
			            			headers:{'content-type': 'application/x-www-form-urlencoded'},
			            			data: Qs.stringify(item)
			            		}).then((response)=>{
			            				lightyear.loading('hide');
			            				// 重新getData()，不需要刷新页面
			            				location.reload();
			                        }).catch((error)=>{
			                        	lightyear.loading('hide');
			                            console.log(error);
			                        })
			                }
			            },
			            close: {
			                text: '关闭'
			            }
			        }
			    });	
			}
		}
	})
	
	// 注册监听器，判断是否刷新
	window.addEventListener('pageshow', function(event) {
		if(sessionStorage.getItem('refresh') === 'true') {
		   location.reload();
		}
		sessionStorage.removeItem('refresh');
	});
	</script>
</body>
</html>